{"version":3,"sources":["../../src/routers/user.js"],"names":["express","require","User","Auth","router","Router","post","req","res","user","body","generateJWT","token","save","status","send","console","log","findByCredentials","email","password","tokens","filter","get","find","users","e","_id","params","id","findById","patch","updates","Object","keys","allowedUpdates","isValidOperation","every","update","includes","error","forEach","delete","findByIdAndDelete","module","exports"],"mappings":"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","file":"user.js","sourcesContent":["const express = require('express')\nconst User = require('../models/user')\nconst Auth = require('../middleware/auth')\nconst router = new express.Router()\n\nrouter.post('/api/users', async (req, res) => {\n    const user = new User(req.body)\n    \n    try {\n        const token = await user.generateJWT()\n        await user.save()\n        res.status(201).send({user, token})\n    } catch (e) {\n        console.log(e)\n        res.status(400).send(e)\n    }\n})\n\nrouter.post('/api/users/login', async (req, res) => {\n    \n\n    try {\n        const user = await User.findByCredentials(req.body.email, req.body.password)\n        const token = await user.generateJWT()\n        res.send({user, token})\n    } catch (e) {\n        console.log(e)\n        res.status(400).send()\n    }\n})\nrouter.post('/api/users/logout',Auth , async (req, res) => {\n    try {  \n        req.user.tokens = req.user.tokens.filter((token) =>{\n            return token.token !== req.token\n        })\n        await req.user.save()\n        res.send()\n    } catch (e) {\n        res.status(500).send()\n    }\n})\nrouter.post('/api/users/logoutAll',Auth , async (req, res) => {\n    try {  \n        req.user.tokens = []\n        await req.user.save()\n        res.send()\n    } catch (e) {\n        res.status(500).send()\n    }\n})\n\nrouter.get('/api/users', Auth, async (req, res) => {\n    try {\n        const users = await User.find({})\n        res.send(users)\n    } catch (e) {\n        res.status(500).send()\n    }\n})\nrouter.get('/api/users/me', Auth, async (req, res) => {\n    try {\n        res.send(req.user)\n    } catch (e) {\n        res.status(500).send()\n    }\n})\n\nrouter.get('/api/users/:id',Auth , async (req, res) => {\n    const _id = req.params.id\n\n    try {\n        const user = await User.findById(_id)\n\n        if (!user) {\n            return res.status(404).send()\n        }\n\n        res.send(user)\n    } catch (e) {\n        res.status(500).send()\n    }\n})\n\nrouter.patch('/api/users/:id',Auth , async (req, res) => {\n    const updates = Object.keys(req.body)\n    const allowedUpdates = ['name', 'email', 'password', 'age']\n    const isValidOperation = updates.every((update) => allowedUpdates.includes(update))\n\n    if (!isValidOperation) {\n        return res.status(400).send({ error: 'Invalid updates!' })\n    }\n\n    try {\n        const user = await User.findById(req.params.id)\n        updates.forEach((update) => user[update] = req.body[update])\n        await user.save()\n        //const user = await User.findByIdAndUpdate(req.params.id, req.body, { new: true, runValidators: true })\n\n        if (!user) {\n            return res.status(404).send()\n        }\n\n        res.send(user)\n    } catch (e) {\n        res.status(400).send(e)\n    }\n})\n\nrouter.delete('/api/users/:id', Auth,async (req, res) => {\n    try {\n        const user = await User.findByIdAndDelete(req.params.id)\n\n        if (!user) {\n            return res.status(404).send()\n        }\n\n        res.send(user)\n    } catch (e) {\n        res.status(500).send()\n    }\n})\n\nmodule.exports = router"]}